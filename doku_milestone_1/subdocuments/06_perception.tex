\documentclass[main.tex]{subfiles}
\begin{document}
	
	\chapter{Perception}
		\chapterauthor{Evan Kapitzke, Jan-Frederik Stock}
 	
 	\section{Technologies}
 	We use RoboSherlock to define our perception pipeline. For feature extraction in order to classify images we plan to use Caffe, but this is not yet implemented 
 	and will be added for the second milestone.
 	
 	\subsection{RoboSherlock}
	Robosherlock gives the user the opportunity to string together several annotators, forming a perception pipeline. These annotators are individual pieces of
	software, which perform a specific task on the input data and save the result in RoboSherlock's internal data structure, the CAS (Common Analysis Structure).
	Robosherlock provides several annotators, but own annotators can be added. The exact specifications of the RoboSherlock pipeline used by us will be document in
	the pipeline definition section.\\
	
	RoboSherlock is open source and developed by the Institute of Artificial Intelligence at the University of Bremen and you can find the github repository at 			github.com/RoboSherlock/robosherlock.
 	
 	\subsection{Caffe}
 	Caffe is a neural networking framework. You can use it to train your own neural networks, or work with existing and pre-trained ones.\\
 	
 	We plan to use a pre-trained net for feature extraction in the following way: We insert our training data into the neural network and save the output of the 			nodes belonging to the second last layer of the neural network. This data are our extracted features. We can now use them together with the labels belonging to 	the pictures we inserted, to train different machine learning algorithms, like for example KNN.\\
 	
 	Caffe is also open source, and you can find more information at caffe.berkeleyvision.org.\\
 	
 	\section{Package}
 	\subsection{Launchfile}
 	The launchfile hsr\_demo\_perception.launch instantiates RoboSherlock with our hsrb\_1ms.yaml Pipeline definition.
 	In addition, it also starts our hermes\_planning script which parses the output messages of RoboSherlock.
 	
 	\subsection{Hermes\_planning}
 	Hermes\_planning subscribes to the /perception\_pipeline/result\_advertiser and parses the JSON strings of the published messages.
 	It also creates an RSObject message which is published to the topic /perception\_output/planning.
 	The RSObject message contains all necessary information that is needed to locate and identify an object.
 	
 	\subsection{Trigger}
 	After launching  hsr\_demo\_perception, the pipeline waits until it is triggered by calling "rosservice call /perception\_pipeline/trigger".
 	Each trigger only starts a single computation cycle.
 	
 	\subsection{Pipeline definition}
 	The used pipeline is located in the file hsrb\_1ms.yaml.
 	\begin{itemize}
  		\item CollectionReader: Reads raw images from the camera topics. Those are defined in config\_hsrb.ini.
  		\item ImagePreprocessor: Image preprocessing of the camera input.
  		\item PointCloudFilter: Filters corrupted and unneeded points out of our pointcloud.
  		\item NormalEstimator: Estimates the normals in a given scene.
  		\item  PlaneAnnotator: Calculates the planes in a given scene.
  		\item  PointCloudClusterExtractor: Extracts clusters out of our currently processed pointcloud.
  		\item  ClusterMerger: Merges the points in a detected cluster.
  		\item  ClusterColorHistogramCalculator: Counts the colors in a cluster and returns the most relevant colors. We use this for our color\_name value.
  		\item  Cluster3DGeometryAnnotator: Calculates a bounding box for each detected cluster. We use this for our x, y, z, width, height and depth values.
  		\item TFBroadcaster: Publishes all gathered information to the topic /perception\_pipeline/result\_advertiser.
  	\end{itemize}
  
 	\subsection{Messages}
 	We defined one additional message RSObject. It is available in the suturo\_resources resources repository:
 	
 	\begin{verbatim}float32 x 
	float32 y
	float32 z
	float32 w 	# Breite
	float32 h 	# HÃ¶he
	float32 d 	# Tiefe
	float32 confidence
	string color_name
\end{verbatim}

	It is available in the suturo\_resources resources Repository.
\end{document}
