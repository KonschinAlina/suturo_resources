\documentclass[main.tex]{subfiles}


\begin{document}
 \section{Perception}
 \subsection{Main Perception packages}
 Create a new workspace or open the workspace where you want to install the Perception part. If you are using the same workspaces we do, use the suturo\_ws workspace.

 Now install the rs\_addons dependencies by running the following commands.
 \begin{lstlisting}
sudo add-apt-repository ppa:robosherlock/ppa
sudo apt-get update
sudo apt-get install rapidjson 
\end{lstlisting} 
 
  Then run the following commands to download dependencies and the Perception part into your workspace. If you want to install Caffe, it is important to run "catkin build" \textbf{after} Caffe was successfully installed.
 
 \begin{lstlisting}
cd src
git clone %*\url{https://github.com/SUTURO/suturo_perception.git}*)
git clone %*\url{https://github.com/SUTURO/suturo_resources.git}*) 
git clone %*\url{https://github.com/evankapi/rs_hsrb_perception.git}*) -\b suturo20
git clone %*\url{https://github.com/RoboSherlock/robosherlock.git}*) --\recursive
cd robosherlock
git checkout eda6b38ecc6df7dbe9c12cb02af314729a66a9ef
cd ..
git clone %*\url{https://github.com/RoboSherlock/rs_resources.git}*)
git clone %*\url{https://github.com/Jastock/rs_addons.git}*)
rosdep install --from-path . --ignore-src -r 
cd ..
catkin build
\end{lstlisting}
 
 
\subsection{Caffe}
To install Caffe, use the following commands.
 \begin{lstlisting}
sudo apt-get update
sudo apt-get install libprotobuf-dev libleveldb-dev libsnappy-\dev libopencv-dev libhdf5-serial-dev protobuf-compiler
sudo apt-get install --no-install-recommends libboost-all-dev
sudo apt-get install libgflags-dev
sudo apt-get install libgoogle-glog-dev
sudo apt-get install libopenblas-dev
sudo apt-get install liblmdb-dev
cd 
git clone %*\url{https://github.com/BVLC/caffe.git}*)
\end{lstlisting}
 
 For GPU acceleration install \href{https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#ubuntu-installation}{CUDA}, a graphics card driver update may be necessary for this to work.
 
 Installation with CMake:\\
 
 Change into your caffe directory and open up the CMakeLists.txt in your editor. After the comment labeled "Options" you can set options for your build. If you installed CUDA and want GPU acceleration set CPU\_ONLY to OFF, otherwise set it to on ON.
 
 Now enter your cmake directory and open up the Dependencies.cmake file. Go to the comment labeled "BLAS" and in the line under 
 
 \begin{lstlisting}
 if(NOT APPLE)
\end{lstlisting}
 
 change it to 
 
 \begin{lstlisting}
 set(BLAS "Open" CACHE STRING "Selected BLAS library")
\end{lstlisting}
 
 Exit the file and from your cmake directory run the following commands:
 \begin{lstlisting}
 cmake ..
 make all
 make install
 make runtest
\end{lstlisting}

\newpage
 
 
 
 
Installation with make:

The installation with cmake is highly recommended, but if this should not work, the following is the alternative.

 Make following changes to the Caffe directory : \\

Copy the Makefile.config.example with 
\begin{lstlisting}
cp Makefile.config.example Makefile.config
\end{lstlisting}
Make the following changes on the Makefile.config :\\

If CUDA is not installed uncomment CPU\_ONLY := 1 to enable building for CPU only.\\
Change "BLAS := atlas" to "BLAS := open"\\
If any hdf5 related erros appear in the next step, add 
\begin{lstlisting}
/usr/lib/x86_64-linux-gnu/hdf5/serial
\end{lstlisting}
 to LIBRARY\_DIRS and
\begin{lstlisting} 
  /usr/include/hdf5/serial/ 
\end{lstlisting} 
  to INCLUDE\_DIRS.\\
Now save and exit.

 	
Now you need to build caffe using the following commands.
\begin{lstlisting}
make all
make test
make runtest  
\end{lstlisting}

\subsection{Further steps after downloading the packages, dependecies and installing Caffe}


If all the tests are successfull, you can now build your workspace using
\begin{lstlisting}
catkin build
\end{lstlisting}

To be able to use Caffe, you now need to download a trained model file, or train your own network. To download the "bvlc\_reference\_caffenet", which was used in the SUTURO project, change to the "scripts" directory in your caffe directory. You can now download the trained model by executing

\begin{lstlisting}
./download\_model\_binary.py ../models/bvlc\_reference\_caffenet/
\end{lstlisting}

If you encounter the following problem while using your Caffe installation, you can fix it with the following commands:

Problem:

\begin{lstlisting}
fatal error: caffe/proto/caffe.pb.h: No such file or directory
\end{lstlisting}

Fix, this must be executed in your caffe directory:


\begin{lstlisting}
protoc src/caffe/proto/caffe.proto --cpp_out=.
mkdir include/caffe/proto
mv src/caffe/proto/caffe.pb.h include/caffe/proto
\end{lstlisting}



For information on how to do feature extraction with Caffe see \ref{feature_extraction}, information on how to classify with the rs\_addons package and Caffe can be found at \ref{classifying}. 

\subsection{Feature Extraction} \label{feature_extraction}

\subsection{Classifying} \label{classifying}
 
\end{document}
